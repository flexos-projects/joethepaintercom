---
import BaseLayout from '@layouts/BaseLayout.astro';
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import SocialShareButtons from '@/components/SocialShareButtons.astro';
import CTABanner from '@/components/sections/CTABanner.astro';
import Icon from '@/components/ui/Icon.astro'; // Assuming an Icon component

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { title, description, pubDate, author, image, tags } = post.data;

const formattedDate = pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const ogImage = image?.url ? new URL(image.url, Astro.site).href : '/images/social-share-default.jpg';
---

<BaseLayout
  title={`${title} | Joe the Painter`}
  description={description}
  ogImage={ogImage}
>
  <article class="container mx-auto px-spacing-4 py-spacing-16 md:py-spacing-20 max-w-4xl">
    <header class="mb-spacing-10 text-center">
      <time datetime={pubDate.toISOString()} class="font-body text-text-muted text-sm font-medium block mb-spacing-2">
        {formattedDate}
      </time>
      <h1 class="font-heading text-4xl md:text-5xl font-bold text-text-dark leading-tight mb-spacing-6">
        {title}
      </h1>
      <p class="font-body text-lg md:text-xl text-text-muted mb-spacing-8">
        {description}
      </p>
      <div class="flex items-center justify-center gap-spacing-3 text-text-muted text-base font-medium">
        <Icon name="user" class="w-spacing-5 h-spacing-5" aria-hidden="true" />
        <span class="font-body">By {author}</span>
      </div>
    </header>

    {image && (
      <figure class="mb-spacing-10">
        <Image
          src={image.url}
          alt={image.alt}
          width={1200}
          height={675}
          format="webp"
          quality={80}
          class="w-full h-auto rounded-lg shadow-md object-cover"
          loading="eager"
        />
        {image.alt && <figcaption class="sr-only">{image.alt}</figcaption>}
      </figure>
    )}

    <div class="prose prose-lg max-w-none font-body text-text-dark leading-relaxed">
      <slot />
    </div>

    <footer class="mt-spacing-16 pt-spacing-10 border-t border-border flex flex-col md:flex-row items-center justify-between gap-spacing-6">
      <div class="flex flex-wrap gap-spacing-2">
        <span class="font-body text-text-dark font-medium text-lg sr-only">Tags:</span>
        {tags.map((tag) => (
          <a
            href={`/blog/tags/${tag.toLowerCase().replace(/\s+/g, '-')}`}
            class="font-body text-sm bg-background hover:bg-border text-primary-blue border border-border px-spacing-3 py-spacing-1.5 rounded-full transition-colors duration-fast"
            aria-label={`View all posts tagged "${tag}"`}
          >
            #{tag}
          </a>
        ))}
      </div>
      <SocialShareButtons title={title} url={Astro.url} class="flex-shrink-0" />
    </footer>
  </article>

  <CTABanner
    headline="Ready to Transform Your Space?"
    description="Schedule a free, no-obligation consultation with Joe to discuss your painting or handyman project."
    ctaText="Book Your Free Consultation"
    ctaHref="/contact"
  />
</BaseLayout>