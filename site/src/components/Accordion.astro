---
import type { HTMLAttributes } from 'astro/types';

interface Props extends HTMLAttributes<'details'> {
  question: string;
  id: string; // Unique ID for accordion item
  initiallyOpen?: boolean;
}

const { question, id, initiallyOpen = false, class: className, ...attrs } = Astro.props;
---

<details
  id={id}
  class:list={['border-b border-border py-4', className]}
  {...attrs}
  {...initiallyOpen && { open: true }} // Conditionally apply 'open' attribute if initiallyOpen is true
>
  <summary
    class="flex justify-between items-center w-full text-left p-2 -ml-2 rounded-md cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary text-lg font-semibold text-text-dark"
  >
    <span class="pr-2">{question}</span>
    <svg
      class:list={[
        'w-5 h-5 flex-shrink-0 motion-safe:transition-transform motion-reduce:transition-none duration-200',
        initiallyOpen ? 'rotate-180' : '' // Apply initial rotation if open
      ]}
      fill="currentColor"
      viewBox="0 0 20 20"
      xmlns="http://www.w3.org/2000/svg"
      aria-hidden="true"
    >
      <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
    </svg>
  </summary>
  <div class="mt-2 pl-2 text-text-muted text-base pb-2">
    <slot />
  </div>
</details>

<script is:inline>
  document.querySelectorAll('details').forEach(detail => {
    const icon = detail.querySelector('summary svg');

    if (!icon) return;

    // Listen for the native 'toggle' event on the <details> element
    detail.addEventListener('toggle', () => {
      if (detail.open) {
        icon.classList.add('rotate-180');
      } else {
        icon.classList.remove('rotate-180');
      }
    });
  });
</script>