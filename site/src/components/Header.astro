---
import { Image } from 'astro:assets';
import Button from './ui/Button.astro';

// Assuming a logo SVG exists in public/images/logo.svg
const logoSrc = '/images/logo.svg';
const logoAlt = 'Joe the Painter Logo';

// Navigation Links
const navLinks = [
  { name: 'Home', href: '/' },
  { name: 'Painting Services', href: '/services/painting' },
  { name: 'Handy Services', href: '/services/handy' },
  { name: 'Our Work', href: '/our-work' },
  { name: 'About Joe', href: '/about' },
  { name: 'Contact', href: '/contact' },
];

// State for mobile menu
let isMobileMenuOpen = false;

// Client-side script for mobile menu toggle
// Using client:load for the script to ensure it runs
// and toggle the class on the mobile menu and button.
---

<header class="sticky top-0 z-50 bg-surface shadow-md">
  <div class="container mx-auto px-4 py-4 flex items-center justify-between">
    <a href="/" class="flex items-center" aria-label="Joe the Painter Homepage">
      <Image src={logoSrc} alt={logoAlt} width={40} height={40} class="h-10 w-auto" />
      <span class="ml-3 font-heading text-2xl font-bold text-text-dark">JOE THE PAINTER</span>
    </a>

    <!-- Desktop Navigation -->
    <nav class="hidden lg:flex items-center gap-6" aria-label="Main navigation">
      <ul role="list" class="flex gap-6">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class={`font-body text-base font-medium text-text-dark hover:text-primary transition-colors duration-150
                ${Astro.url.pathname === link.href ? 'text-primary border-b-2 border-primary pb-1' : ''}`}
            >
              {link.name}
            </a>
          </li>
        ))}
      </ul>
      <Button href="/consultation" variant="primary" size="md" class="ml-4">
        Book a Free Consultation
      </Button>
    </nav>

    <!-- Mobile Navigation Toggle -->
    <div class="lg:hidden flex items-center">
      <Button
        id="mobile-menu-button"
        variant="ghost"
        size="md"
        aria-label="Toggle mobile menu"
        aria-expanded={isMobileMenuOpen}
        class="text-text-dark hover:bg-background"
      >
        <svg
          class="w-7 h-7"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d={isMobileMenuOpen ? "M6 18L18 6M6 6l12 12" : "M4 6h16M4 12h16M4 18h16"}
          ></path>
        </svg>
      </Button>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <nav
    id="mobile-menu"
    class={`fixed inset-0 bg-surface z-40 transform ${isMobileMenuOpen ? 'translate-x-0' : 'translate-x-full'}
           transition-transform duration-300 ease-in-out lg:hidden`}
    aria-label="Mobile navigation"
    aria-hidden={!isMobileMenuOpen}
  >
    <div class="flex justify-end p-4">
      <Button
        variant="ghost"
        size="md"
        aria-label="Close mobile menu"
        class="text-text-dark hover:bg-background"
        onclick="document.getElementById('mobile-menu-button').click()"
      >
        <svg
          class="w-7 h-7"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </Button>
    </div>
    <ul role="list" class="flex flex-col items-center justify-center h-full space-y-8">
      {navLinks.map((link) => (
        <li>
          <a
            href={link.href}
            class={`font-heading text-3xl text-text-dark hover:text-primary transition-colors duration-150
              ${Astro.url.pathname === link.href ? 'text-primary' : ''}`}
            onclick="document.getElementById('mobile-menu-button').click()"
          >
            {link.name}
          </a>
        </li>
      ))}
      <li class="mt-8">
        <Button href="/consultation" variant="primary" size="lg" onclick="document.getElementById('mobile-menu-button').click()">
          Book a Free Consultation
        </Button>
      </li>
    </ul>
  </nav>
</header>

<script is:inline>
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  let isMenuOpen = false;

  const toggleMobileMenu = () => {
    isMenuOpen = !isMenuOpen;
    mobileMenuButton?.setAttribute('aria-expanded', String(isMenuOpen));
    mobileMenu?.setAttribute('aria-hidden', String(!isMenuOpen));
    if (mobileMenu) {
      mobileMenu.classList.toggle('translate-x-full', !isMenuOpen);
      mobileMenu.classList.toggle('translate-x-0', isMenuOpen);
    }
    document.body.style.overflow = isMenuOpen ? 'hidden' : ''; // Lock scroll
  };

  mobileMenuButton?.addEventListener('click', toggleMobileMenu);

  // Close menu if a link inside is clicked (handled by onclick on links themselves)
  // Also close on resize to desktop
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 1024 && isMenuOpen) {
      toggleMobileMenu(); // Force close if desktop breakpoint hit
    }
  });

  // Ensure initial state is correct in case of back navigation
  document.addEventListener('astro:after-swap', () => {
    if (window.innerWidth >= 1024 && isMenuOpen) {
      toggleMobileMenu();
    }
  });
</script>