---
import { Image } from 'astro:assets';
import MarkdownContent from '@components/content/MarkdownContent.astro';
import ProcessStep from '@components/ui/ProcessStep.astro';
import Button from '@components/ui/Button.astro';

interface Service {
  title: string;
  slug: string;
  longDescription: string;
  benefits: string[];
  processSteps?: {
    title: string;
    description: string;
    image?: { src: string; alt: string; };
  }[];
  featuredImage: {
    src: string;
    alt: string;
    caption?: string;
  };
  galleryImages?: {
    src: string;
    alt: string;
    caption?: string;
  }[];
  faqs?: {
    question: string;
    answer: string;
  }[];
  ctaText: string;
}

interface Props {
  service: Service;
  index: number; // To alternate background colors
}

const { service, index } = Astro.props;
const sectionId = service.slug;
const backgroundClass = index % 2 === 0 ? 'bg-background' : 'bg-surface'; // Alternate backgrounds
---

<section id={sectionId} class={`py-16 md:py-24 ${backgroundClass}`}>
  <div class="container mx-auto px-4 max-w-7xl">
    <h2 class="font-heading text-4xl md:text-5xl font-bold text-text-dark mb-10 text-center">
      {service.title}
    </h2>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-start">
      <div class="order-2 lg:order-1 flex flex-col gap-y-8">
        <div class="prose prose-lg max-w-none text-text-muted">
          <MarkdownContent content={service.longDescription} />
        </div>

        <div>
          <h3 class="font-heading text-2xl font-semibold text-text-dark mb-4">Benefits of Choosing Joe</h3>
          <ul role="list" class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-3 text-text-muted">
            {service.benefits.map((benefit) => (
              <li class="flex items-start gap-x-2">
                <svg class="flex-shrink-0 w-6 h-6 text-primary mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>{benefit}</span>
              </li>
            ))}
          </ul>
        </div>
      </div>

      <div class="order-1 lg:order-2">
        <Image
          src={service.featuredImage.src}
          alt={service.featuredImage.alt}
          width={800}
          height={500}
          class="rounded-xl shadow-xl w-full h-auto object-cover"
          loading="lazy"
          widths={[400, 800, 1200]}
          sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 40vw"
        />
        {service.featuredImage.caption && (
          <p class="text-sm text-text-subtle mt-2 text-center">
            {service.featuredImage.caption}
          </p>
        )}
      </div>
    </div>

    {service.processSteps && service.processSteps.length > 0 && (
      <div class="mt-16 md:mt-24">
        <h3 class="font-heading text-3xl font-bold text-text-dark mb-8 text-center">Our {service.title.split(' ')[0]} Process</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          {service.processSteps.map((step, i) => (
            <ProcessStep stepNumber={i + 1} title={step.title} description={step.description} image={step.image} />
          ))}
        </div>
      </div>
    )}

    {service.galleryImages && service.galleryImages.length > 0 && (
      <div class="mt-16 md:mt-24">
        <h3 class="font-heading text-3xl font-bold text-text-dark mb-8 text-center">Gallery</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {service.galleryImages.map((img) => (
            <figure class="rounded-xl overflow-hidden shadow-md">
              <Image
                src={img.src}
                alt={img.alt}
                width={600}
                height={400}
                class="w-full h-48 object-cover"
                loading="lazy"
                widths={[300, 600, 900]}
                sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 30vw"
              />
              {img.caption && <figcaption class="p-4 text-sm text-text-muted">{img.caption}</figcaption>}
            </figure>
          ))}
        </div>
      </div>
    )}

    {service.faqs && service.faqs.length > 0 && (
      <div class="mt-16 md:mt-24">
        <h3 class="font-heading text-3xl font-bold text-text-dark mb-8 text-center">Frequently Asked Questions</h3>
        <div class="space-y-6 max-w-3xl mx-auto">
          {service.faqs.map((faq) => (
            <details class="group bg-surface rounded-lg shadow-md p-6 border border-border">
              <summary class="flex justify-between items-center cursor-pointer text-text-dark font-semibold text-lg hover:text-primary transition">
                {faq.question}
                <svg class="w-6 h-6 transform transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </summary>
              <div class="mt-4 text-text-muted prose max-w-none">
                <MarkdownContent content={faq.answer} />
              </div>
            </details>
          ))}
        </div>
      </div>
    )}

    <div class="mt-16 md:mt-24 text-center">
      <Button
        href="/consultation"
        variant="primary"
        size="lg"
        aria-label={`Book a free consultation for ${service.title}`}
      >
        {service.ctaText}
      </Button>
    </div>
  </div>
</section>