---
import { Image } from 'astro:assets';
// The JS import for client-side execution should be in the <script> block.
// Removed: import { initializeBeforeAfterSlider } from '@/utils/beforeAfterSlider';

interface Props {
  beforeImage: { src: string; alt: string; };
  afterImage: { src: string; alt: string; };
  width?: number; // Optional, for responsive image generation
  height?: number; // Optional, for responsive image generation
  aspectRatio?: string; // e.g., "16/9", "4/3"
}

const { beforeImage, afterImage, width, height, aspectRatio = '16/9' } = Astro.props;

// Generate unique ID for the slider instance if multiple are on a page
const uniqueId = `before-after-slider-${Math.random().toString(36).substring(2, 9)}`;
---

<div
  id={uniqueId}
  class="relative w-full overflow-hidden rounded-lg shadow-md group select-none touch-none"
  style={`padding-bottom: calc(100% / (${aspectRatio}));`}
  role="group"
  aria-label="Before and After Image Comparison Slider"
>
  <!-- After Image (Full width, static background) -->
  <Image
    src={afterImage.src}
    alt={afterImage.alt}
    class="absolute inset-0 w-full h-full object-cover z-10"
    {width}
    {height}
    loading="lazy"
    decoding="async"
    densities={[1.5, 2]}
  />

  <!-- Before Image (Clipped, foreground) -->
  <div
    data-slider-before-image-container
    class="absolute inset-0 w-1/2 h-full overflow-hidden z-20"
    style="width: 50%;"
  >
    <Image
      src={beforeImage.src}
      alt={beforeImage.alt}
      class="absolute inset-0 w-full h-full object-cover z-20"
      {width}
      {height}
      loading="lazy"
      decoding="async"
      densities={[1.5, 2]}
    />
  </div>

  <!-- Divider Line -->
  <div
    data-slider-divider
    class="absolute top-0 bottom-0 left-1/2 w-px bg-border-light z-30 pointer-events-none"
    style="left: 50%;"
  ></div>

  <!-- Handle -->
  <div
    data-slider-handle
    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 md:w-10 md:h-10 bg-primary-blue rounded-full shadow-md flex items-center justify-center z-40 cursor-ew-resize transition-colors duration-200
           hover:bg-primary-blue-hover focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-blue focus-visible:ring-opacity-75 focus-visible:ring-offset-2 focus-visible:ring-offset-surface-light"
    style="left: 50%;"
    tabindex="0"
    role="slider"
    aria-valuemin="0"
    aria-valuemax="100"
    aria-valuenow="50"
    aria-label="Adjust image comparison"
  >
    <svg
      class="w-4 h-4 text-surface-light pointer-events-none"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      aria-hidden="true"
    >
      <!-- Two arrows pointing inwards for a horizontal slider handle -->
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5 5-5m2 10l5-5-5-5"></path>
    </svg>
  </div>
</div>

<script define:vars={{ uniqueId }}>
  import { initializeBeforeAfterSlider } from '@/utils/beforeAfterSlider';

  // Wait for the DOM to be fully loaded before initializing the slider
  document.addEventListener('DOMContentLoaded', () => {
    const sliderElement = document.getElementById(uniqueId);
    if (sliderElement) {
      initializeBeforeAfterSlider(sliderElement);
    }
  });
</script>