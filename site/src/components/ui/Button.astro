---
import type { HTMLAttributes } from 'astro/types';

interface Props extends HTMLAttributes<'button'> {
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  href?: string; // Optional for anchor buttons
  disabled?: boolean;
  loading?: boolean;
}

const {
  variant = 'primary',
  size = 'md',
  href,
  disabled = false,
  loading = false,
  class: className,
  ...attrs
} = Astro.props;

// Base classes derived from 06-design.md -> Component Styles -> Buttons -> Base Styling
const baseClasses = 'inline-flex items-center justify-center font-body font-semibold text-center no-underline cursor-pointer border border-transparent ' +
                    'transition-all duration-fast ease-default rounded-md ' +
                    'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary';

// Variant classes derived from 06-design.md -> Component Styles -> Buttons -> Variants
const variantClasses = {
  primary: `bg-primary text-surface border-primary
            hover:bg-primary-dark hover:border-primary-dark hover:shadow-sm
            active:bg-primary-active active:border-primary-active active:translate-y-px`,
  secondary: `bg-secondary text-surface border-secondary
              hover:bg-secondary-hover hover:border-secondary-hover hover:shadow-sm
              active:bg-secondary-active active:border-secondary-active active:translate-y-px`,
  outline: `bg-transparent text-primary border-primary
            hover:bg-primary hover:text-surface hover:shadow-sm
            active:bg-primary-active active:border-primary-active active:text-surface active:translate-y-px`,
  ghost: `bg-transparent text-primary border-transparent
          hover:bg-primary/[0.05]
          active:bg-primary/[0.1] active:translate-y-px`,
};

// Size classes derived from 06-design.md -> Component Styles -> Buttons -> Sizes
const sizeClasses = {
  sm: 'px-3 py-2 text-sm', // maps to spacing-3, spacing-2, font-size-sm
  md: 'px-4 py-3 text-base', // maps to spacing-4, spacing-3, font-size-base
  lg: 'px-6 py-4 text-lg', // maps to spacing-6, spacing-4, font-size-lg
};

// Disabled classes derived from 06-design.md -> Component Styles -> Buttons -> Variants -> Disabled
// Using direct hex values from the spec as these are specific overrides for disabled state
const disabledClasses = 'bg-text-subtle border-text-subtle text-surface cursor-not-allowed pointer-events-none';
const loadingClasses = 'relative !cursor-wait'; // !important to override default cursor
---

{href ? (
  <a
    href={href}
    class:list={[
      baseClasses,
      variantClasses[variant],
      sizeClasses[size],
      disabled || loading ? disabledClasses : '',
      loading ? loadingClasses : '',
      className,
    ]}
    aria-disabled={disabled || loading}
    tabindex={disabled || loading ? -1 : undefined}
    {...attrs}
  >
    {loading && (
      <span class="absolute inset-0 flex items-center justify-center">
        <svg class="animate-spin-slow h-5 w-5 text-current" viewBox="0 0 24 24" aria-hidden="true">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </span>
    )}
    <span class:list={[loading ? 'opacity-0' : '']}>
      <slot />
    </span>
  </a>
) : (
  <button
    type="button"
    disabled={disabled || loading}
    class:list={[
      baseClasses,
      variantClasses[variant],
      sizeClasses[size],
      disabled || loading ? disabledClasses : '',
      loading ? loadingClasses : '',
      className,
    ]}
    {...attrs}
  >
    {loading && (
      <span class="absolute inset-0 flex items-center justify-center">
        <svg class="animate-spin-slow h-5 w-5 text-current" viewBox="0 0 24 24" aria-hidden="true">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </span>
    )}
    <span class:list={[loading ? 'opacity-0' : '']}>
      <slot />
    </span>
  </button>
)}