---
/**
 * Input.astro
 * Reusable input and textarea component for form fields, ensuring consistent styling,
 * accessibility, and proper feedback states (focus, error, disabled).
 */

// Type imports
import type { HTMLAttributes } from 'astro/types';

// Define common input types
type InputType =
  | 'text'
  | 'email'
  | 'tel'
  | 'password'
  | 'number'
  | 'url'
  | 'search'
  | 'date'
  | 'time'
  | 'datetime-local'
  | 'month'
  | 'week';

// Props interface with JSDoc comments
interface Props extends HTMLAttributes<'input' | 'textarea'> {
  /** The unique ID for the input field, essential for label association. */
  id: string;
  /** The name attribute for the input field, used in form submission. */
  name: string;
  /** The type of the input field (e.g., 'text', 'email', 'password'). */
  type?: InputType;
  /** Placeholder text for the input field. */
  placeholder?: string;
  /** The current value of the input field. */
  value?: string;
  /** Indicates if the input field is required. */
  required?: boolean;
  /** Indicates if the input field is disabled. */
  disabled?: boolean;
  /** Indicates if the input field is read-only. */
  readonly?: boolean;
  /** Indicates if the input field is in an error state. */
  error?: boolean;
  /** Optional class names to apply to the input field. */
  class?: string;
  /** If true, renders a textarea instead of an input. */
  textarea?: boolean;
  /** Number of rows for a textarea. Only applicable if `textarea` is true. */
  rows?: number;
  /** Minimum length for text/textarea inputs. */
  minlength?: number;
  /** Maximum length for text/textarea inputs. */
  maxlength?: number;
  /** Autocomplete attribute for input fields. */
  autocomplete?: string;
}

// Destructure with defaults
const {
  id,
  name,
  type = 'text',
  placeholder,
  value,
  required = false,
  disabled = false,
  readonly = false,
  error = false,
  class: className,
  textarea = false,
  rows = 4, // Default rows for textarea
  minlength,
  maxlength,
  autocomplete,
  ...attrs // Spread any additional attributes
} = Astro.props;

// Base classes for both input and textarea
const baseClasses = [
  'block',
  'w-full',
  'font-body',
  'text-base',
  'text-text',
  'bg-surface',
  'border',
  'border-border',
  'rounded-md',
  'py-3', // Tailwind's `py-3` is 12px, matching spacing-3
  'px-4', // Tailwind's `px-4` is 16px, matching spacing-4
  'placeholder:text-textMuted', // Placeholder color
  'transition-all',
  'duration-fast', // From design tokens
  'ease-in-out', // From design tokens
  'focus:outline-none',
  'focus:border-primary',
  'focus:ring-2',
  'focus:ring-primary/[.2]', // Custom focus shadow rgba(0, 71, 171, 0.2)
  'motion-reduce:transition-none', // Accessibility: Reduced motion
];

// Classes for error state
const errorClasses = error ? ['border-error', 'focus:border-error', 'focus:ring-error/[.2]'] : [];

// Classes for disabled state
const disabledClasses = disabled ? ['bg-background', 'cursor-not-allowed', 'text-textSubtle'] : [];
---

{
  textarea ? (
    <textarea
      id={id}
      name={name}
      rows={rows}
      placeholder={placeholder}
      required={required}
      disabled={disabled}
      readonly={readonly}
      minlength={minlength}
      maxlength={maxlength}
      autocomplete={autocomplete}
      aria-invalid={error ? 'true' : 'false'}
      class:list={[...baseClasses, ...errorClasses, ...disabledClasses, className]}
      {...attrs}
    >{value}</textarea>
  ) : (
    <input
      id={id}
      name={name}
      type={type}
      value={value}
      placeholder={placeholder}
      required={required}
      disabled={disabled}
      readonly={readonly}
      minlength={minlength}
      maxlength={maxlength}
      autocomplete={autocomplete}
      aria-invalid={error ? 'true' : 'false'}
      class:list={[...baseClasses, ...errorClasses, ...disabledClasses, className]}
      {...attrs}
    />
  )
}