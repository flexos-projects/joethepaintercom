```astro
---
import Input from '@/components/ui/Input.astro';
import Button from '@/components/ui/Button.astro';
import { useState } from 'react'; // For client-side state in Astro component with client:load

// Assuming Formspree endpoint is configured via environment variable
const FORMSPREE_ENDPOINT_URL = import.meta.env.FORMSPREE_ENDPOINT_URL || 'https://formspree.io/f/yourformid';

// Placeholder for reCAPTCHA script (will be loaded client-side)
// The actual reCAPTCHA integration would involve a client-side script that
// executes on form submission and adds a token to the form data.
// For this example, we'll simulate it.
---

<form
  id="consultation-form"
  method="POST"
  action={FORMSPREE_ENDPOINT_URL}
  class="space-y-6 max-w-lg mx-auto p-6 bg-surface rounded-lg shadow-md"
  aria-labelledby="consultation-form-title"
>
  <h2 id="consultation-form-title" class="font-heading text-3xl font-bold text-center text-text-dark mb-6">
    Book Your Free Consultation
  </h2>
  <p class="text-text-muted text-center mb-6">
    Let's discuss your project. No pressure, just expert advice from Joe himself.
  </p>

  <Input label="Full Name" id="fullName" name="fullName" type="text" placeholder="John Doe" required />
  <Input label="Email Address" id="email" name="email" type="email" placeholder="john.doe@example.com" required />
  <Input label="Phone Number" id="phone" name="phone" type="tel" placeholder="(760) 555-1234" required />

  <Input
    label="Project Type"
    id="projectType"
    name="projectType"
    as="select"
    placeholder="Select a service type"
    required
    options={[
      { value: 'painting', label: 'Painting Services' },
      { value: 'handy', label: 'Handy Services' },
      { value: 'both', label: 'Both Painting & Handy Services' },
    ]}
  />

  <Input label="Service Location (City/Zip)" id="serviceLocation" name="serviceLocation" type="text" placeholder="Carlsbad, CA 92008" required />
  <Input label="Project Details" id="projectDetails" name="projectDetails" as="textarea" placeholder="Tell Joe about your project (e.g., 'Exterior house paint, 3 bedrooms')" required />

  <div>
    <p class="block text-sm font-medium text-text-dark mb-2">Preferred Contact Method <span class="text-error ml-1">*</span></p>
    <div class="flex items-center space-x-4">
      <div class="flex items-center">
        <input
          type="radio"
          id="contactPhone"
          name="preferredContact"
          value="phone"
          class="h-4 w-4 text-primary border-border focus:ring-primary"
          required
        />
        <label for="contactPhone" class="ml-2 text-text-dark text-base">Phone Call</label>
      </div>
      <div class="flex items-center">
        <input
          type="radio"
          id="contactEmail"
          name="preferredContact"
          value="email"
          class="h-4 w-4 text-primary border-border focus:ring-primary"
          required
        />
        <label for="contactEmail" class="ml-2 text-text-dark text-base">Email</label>
      </div>
    </div>
  </div>

  <Input label="How Did You Hear About Joe?" id="howHear" name="howHear" type="text" placeholder="Google, Friend's referral, Yelp (Optional)" />

  <!-- reCAPTCHA placeholder -->
  <div id="recaptcha-container" class="g-recaptcha" data-sitekey="YOUR_RECAPTCHA_SITE_KEY"></div>
  <p class="text-xs text-text-muted mt-2">This site is protected by reCAPTCHA and the Google <a href="https://policies.google.com/privacy" class="text-primary hover:underline">Privacy Policy</a> and <a href="https://policies.google.com/terms" class="text-primary hover:underline">Terms of Service</a> apply.</p>

  <Button type="submit" variant="primary" size="lg" class="w-full">
    Request My Free Consultation
  </Button>

  <div id="form-status" aria-live="polite" class="mt-4 text-center"></div>
</form>

<script is:inline>
  // Client-side validation and Formspree submission
  const form = document.getElementById('consultation-form');
  const formStatus = document.getElementById('form-status');
  const submitButton = form?.querySelector('button[type="submit"]');

  // Load reCAPTCHA script dynamically if needed, or assume it's loaded globally
  // const recaptchaScript = document.createElement('script');
  // recaptchaScript.src = 'https://www.google.com/recaptcha/api.js?render=YOUR_RECAPTCHA_SITE_KEY';
  // recaptchaScript.async = true;
  // document.head.appendChild(recaptchaScript);

  form?.addEventListener('submit', async (event) => {
    event.preventDefault(); // Prevent default form submission

    // Basic client-side validation
    const inputs = form.querySelectorAll('input, textarea, select');
    let isValid = true;
    inputs.forEach(input => {
      if (input.required && !input.value.trim()) {
        isValid = false;
        input.classList.add('border-error');
        // Add more robust error message display here, linking to Input.astro error prop
        const errorElement = document.getElementById(`${input.id}-error`);
        if (errorElement) errorElement.textContent = 'This field is required.';
      } else {
        input.classList.remove('border-error');
        const errorElement = document.getElementById(`${input.id}-error`);
        if (errorElement) errorElement.textContent = '';
      }
    });

    if (!isValid) {
      formStatus.innerHTML = '<p class="text-error">Please fill in all required fields.</p>';
      return;
    }

    // Simulate reCAPTCHA token generation (replace with actual reCAPTCHA v3 logic)
    // grecaptcha.ready(function() {
    //   grecaptcha.execute('YOUR_RECAPTCHA_SITE_KEY', {action: 'submit_consultation'}).then(function(token) {
    //     // Add token to form data
    //     const formData = new FormData(form);
    //     formData.append('g-recaptcha-response', token);
    //     sendFormData(formData);
    //   });
    // });
    // For now, without actual reCAPTCHA, just send form data
    const formData = new FormData(form);
    sendFormData(formData);
  });

  async function sendFormData(formData) {
    if (submitButton) {
      submitButton.disabled = true;
      submitButton.innerHTML = '<span class="inline-block animate-spin rounded-full h-5 w-5 border-2 border-r-transparent"></span> Sending Request...';
    }
    formStatus.innerHTML = ''; // Clear previous status

    try {
      const response = await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      });

      if (response.ok) {
        formStatus.innerHTML = '<p class="text-success">Thank You! Your Free Consultation Request Has Been Received. Joe will be in touch within 1 business day.</p>';
        form.reset(); // Clear form fields
        // Potentially close modal or redirect to a thank you page
        setTimeout(() => {
          if (window.location.pathname !== '/thank-you') {
            window.location.href = '/thank-you'; // Redirect to a dedicated thank you page
          }
        }, 3000); // Redirect after 3 seconds
      } else {
        const errorData = await response.json();
        formStatus.innerHTML = `<p class="text-error">Oops! Something went wrong: ${errorData.error || 'Please try again.'}</p>`;
      }
    } catch (error) {
      console.error('Form submission error:', error);
      formStatus.innerHTML = '<p class="text-error">Network error. Please try again or call Joe directly at (760) 580-8173.</p>';
    } finally {
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.innerHTML = 'Request My Free Consultation';
      }
    }
  }
</script>
```