---
// Layout
import BaseLayout from '@layouts/BaseLayout.astro';

// Components
import Hero from '@components/sections/Hero.astro';
import Section from '@components/sections/Section.astro';
import CTABanner from '@components/sections/CTABanner.astro';
import ProjectCard from '@components/cards/ProjectCard.astro'; // Assuming ProjectCard is in cards
import TestimonialCard from '@components/cards/TestimonialCard.astro'; // Assuming TestimonialCard is in cards
import ServiceCard from '@components/cards/ServiceCard.astro'; // Assuming ServiceCard is in cards
import Button from '@components/ui/Button.astro'; // Assuming Button is in ui

// Content Collections
import { getCollection } from 'astro:content';

// Page metadata
const meta = {
  title: 'Carlsbad\'s Trusted Painter & Handyman | Joe the Painter',
  description: 'Expert painting and reliable handyman services in Carlsbad, CA. Joe the Painter offers meticulous craftsmanship for your home or business. Get a free estimate!',
  ogImage: '/images/og/carlsbad.jpg',
};

// Fetching data from content collections
const allServices = await getCollection('service'); // Changed to 'service' as per 04-content-schema.md
const paintingServices = allServices.filter(service => service.data.category === 'Painting' && service.data.published);
const handyServices = allServices.filter(service => service.data.category === 'Handyman' && service.data.published);

const allProjects = await getCollection('project'); // Changed to 'project' as per 04-content-schema.md
const carlsbadProjects = allProjects.filter(project =>
  project.data.location.toLowerCase().includes('carlsbad') && project.data.published
);

const allTestimonials = await getCollection('testimonial'); // Changed to 'testimonial' as per 04-content-schema.md
const carlsbadTestimonials = allTestimonials.filter(testimonial =>
  testimonial.data.location.toLowerCase().includes('carlsbad') && testimonial.data.published
);
---

<BaseLayout {...meta}>
  <Hero
    headline="Carlsbad Homes, Masterfully Transformed."
    subheadline="Dedicated painting and reliable repairs for your Carlsbad property, personally delivered since 2001."
    ctaText="Get Your Free Carlsbad Estimate"
    ctaHref="/contact"
    image={{
      src: "/images/heroes/carlsbad-hero.webp",
      alt: "Beautifully painted modern home exterior in Carlsbad, California"
    }}
    licenseNumber="CA Lic. #802167"
  />

  <Section
    id="local-expertise"
    title="Your Trusted Craftsman for Carlsbad Properties"
    subtitle="With over two decades serving San Diego County, Joe brings unparalleled expertise and a personal touch to every Carlsbad home and business."
    background="light"
    centered
  >
    <p class="font-body text-lg text-text-muted max-w-3xl mx-auto mb-8">
      Carlsbad's unique coastal environment demands specific care. From protecting against salt air and sun exposure to maintaining the sophisticated aesthetics of neighborhoods like Aviara and Bressi Ranch, Joe the Painter understands the local nuances. We use premium, weather-resistant materials and meticulous techniques to ensure your property not only looks its best but is also protected for years to come.
    </p>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <div class="text-center">
        <div class="text-primary mb-4 text-5xl" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5a2.5 2.5 0 0 1 0-5a2.5 2.5 0 0 1 0 5"/></svg>
        </div>
        <h3 class="font-heading text-xl font-semibold mb-2 text-text">Local Insight</h3>
        <p class="font-body text-text-muted">Deep understanding of Carlsbad's climate and architectural styles.</p>
      </div>
      <div class="text-center">
        <div class="text-primary mb-4 text-5xl" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m14 18l-6-6l6-6l1.4 1.4L10.8 12l4.6 4.6L14 18Z" transform="rotate(90 12 12)"/><path fill="currentColor" d="M22 12c0 5.52-4.48 10-10 10S2 17.52 2 12S6.48 2 12 2s10 4.48 10 10m-2 0c0-4.42-3.58-8-8-8S4 7.58 4 12s3.58 8 8 8s8-3.58 8-8"/></svg>
        </div>
        <h3 class="font-heading text-xl font-semibold mb-2 text-text">Coastal Protection</h3>
        <p class="font-body text-text-muted">Specialized techniques and materials for lasting results by the ocean.</p>
      </div>
      <div class="text-center">
        <div class="text-primary mb-4 text-5xl" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M22 12c0 5.52-4.48 10-10 10S2 17.52 2 12S6.48 2 12 2s10 4.48 10 10m-2 0c0-4.42-3.58-8-8-8S4 7.58 4 12s3.58 8 8 8s8-3.58 8-8m-7-5h2v6h-2V7m0 8h2v2h-2v-2"/></svg>
        </div>
        <h3 class="font-heading text-xl font-semibold mb-2 text-text">Quality Guaranteed</h3>
        <p class="font-body text-text-muted">Personal oversight on every project, from start to a perfect finish.</p>
      </div>
    </div>
  </Section>

  <Section
    id="carlsbad-services"
    title="Our Services for Carlsbad Residents & Businesses"
    subtitle="Joe the Painter offers comprehensive painting and handyman solutions tailored to your Carlsbad property."
    centered
  >
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {paintingServices.map(service => (
        <ServiceCard
          title={service.data.title}
          description={service.data.shortDescription}
          href={`/services/${service.slug}`}
          image={service.data.featuredImage}
        />
      ))}
      {handyServices.map(service => (
        <ServiceCard
          title={service.data.title}
          description={service.data.shortDescription}
          href={`/services/${service.slug}`}
          image={service.data.featuredImage}
        />
      ))}
    </div>
  </Section>

  {carlsbadProjects.length > 0 && (
    <Section
      id="carlsbad-projects"
      title="Recent Projects in Carlsbad"
      subtitle="See the transformations Joe the Painter has delivered for your Carlsbad neighbors."
      background="light"
      centered
    >
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {carlsbadProjects.slice(0, 3).map(project => (
          <ProjectCard
            title={project.data.title}
            location={project.data.location}
            shortDescription={project.data.shortDescription}
            image={project.data.featuredImage}
            href={`/projects/${project.slug}`}
          />
        ))}
      </div>
      <div class="mt-12 text-center">
        <Button href="/our-work" variant="outline" size="lg">View All Our Work</Button>
      </div>
    </Section>
  )}

  {carlsbadTestimonials.length > 0 && (
    <Section
      id="carlsbad-testimonials"
      title="What Our Carlsbad Clients Say"
      subtitle="Hear directly from homeowners and businesses who trust Joe the Painter."
      centered
    >
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
        {carlsbadTestimonials.slice(0, 2).map(testimonial => (
          <TestimonialCard
            clientName={testimonial.data.clientName}
            location={testimonial.data.location}
            quote={testimonial.data.quote}
          />
        ))}
      </div>
      <div class="mt-12 text-center">
        <Button href="/testimonials" variant="outline" size="lg">Read All Testimonials</Button>
      </div>
    </Section>
  )}

  <CTABanner
    headline="Ready to Enhance Your Carlsbad Property?"
    description="Contact Joe today for a free, no-obligation consultation on your next painting or handyman project."
    ctaText="Book Your Free Carlsbad Consultation"
    ctaHref="/contact"
  />
</BaseLayout>