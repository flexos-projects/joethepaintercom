---
import { getEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import CtaBlock from '@/components/sections/CtaBlock.astro';
import { Image } from 'astro:assets';
import { generateServiceSchema } from '@/utils/seo';

const paintingService = await getEntry('services', 'painting');

if (!paintingService) {
  return Astro.redirect('/404');
}

const { data: service } = paintingService;

const pageSeo = {
  title: service.seo.title,
  description: service.seo.description,
  keywords: service.seo.keywords,
  ogImage: service.featuredImage.src
};
---

<BaseLayout seo={pageSeo}>
  <Fragment slot="head-schema">
    <script type="application/ld+json">
      {JSON.stringify(generateServiceSchema(Astro, {
        title: service.title,
        shortDescription: service.shortDescription,
        featuredImage: service.featuredImage
      }))}
    </script>
  </Fragment>

  <section class="relative bg-background pt-16 pb-12 overflow-hidden">
    <div class="container mx-auto px-4 grid md:grid-cols-2 gap-12 items-center">
      <div class="text-center md:text-left">
        <h1 class="text-4xl md:text-5xl font-heading font-bold text-text-dark mb-6">
          {service.title}
        </h1>
        <p class="text-lg md:text-xl text-text-muted mb-8">
          {service.shortDescription}
        </p>
        <div class="flex justify-center md:justify-start">
          <a href="/contact" class="btn btn-primary btn-lg">
            {service.ctaText}
          </a>
        </div>
      </div>
      <div class="relative w-full h-64 md:h-96 rounded-lg shadow-xl overflow-hidden">
        <Image
          src={service.featuredImage.src}
          alt={service.featuredImage.alt}
          width={800}
          height={600}
          class="w-full h-full object-cover"
          loading="eager"
        />
        {service.featuredImage.caption && (
          <p class="absolute bottom-4 left-4 text-sm text-white bg-black bg-opacity-50 px-3 py-1 rounded-md">
            {service.featuredImage.caption}
          </p>
        )}
      </div>
    </div>
  </section>

  <section class="container mx-auto px-4 py-16 md:py-24">
    <div class="prose lg:prose-lg max-w-none text-text-dark">
      <h2 class="font-heading text-3xl font-semibold mb-6">What We Offer</h2>
      <Fragment set:html={service.longDescription} />
    </div>

    {service.benefits && service.benefits.length > 0 && (
      <div class="mt-16">
        <h2 class="text-3xl font-heading font-semibold text-text-dark mb-8 text-center">
          Why Choose Joe for Your Painting Project?
        </h2>
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
          {service.benefits.map((benefit) => (
            <div class="bg-surface p-6 rounded-lg shadow-md flex items-start space-x-4">
              <svg class="w-6 h-6 text-primary flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              <p class="text-lg text-text-dark">{benefit}</p>
            </div>
          ))}
        </div>
      </div>
    )}

    {service.processSteps && service.processSteps.length > 0 && (
      <div class="mt-16 md:mt-24">
        <h2 class="text-3xl font-heading font-semibold text-text-dark mb-12 text-center">
          Our Meticulous Painting Process
        </h2>
        <div class="grid lg:grid-cols-2 gap-12">
          {service.processSteps.map((step, index) => (
            <div class="flex flex-col md:flex-row items-start space-x-6">
              <div class="flex-shrink-0 text-primary text-5xl font-bold font-heading mb-4 md:mb-0">
                {String(index + 1).padStart(2, '0')}
              </div>
              <div>
                <h3 class="text-2xl font-heading font-semibold text-text-dark mb-3">
                  {step.title}
                </h3>
                <p class="text-lg text-text-muted">{step.description}</p>
                {step.image && (
                  <Image
                    src={step.image.src}
                    alt={step.image.alt}
                    width={400}
                    height={300}
                    class="mt-6 rounded-lg shadow-md"
                    loading="lazy"
                  />
                )}
              </div>
            </div>
          ))}
        </div>
      </div>
    )}

    {service.galleryImages && service.galleryImages.length > 0 && (
      <div class="mt-16 md:mt-24">
        <h2 class="text-3xl font-heading font-semibold text-text-dark mb-8 text-center">
          Explore Our Work
        </h2>
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {service.galleryImages.map((img) => (
            <div class="rounded-lg shadow-md overflow-hidden">
              <Image
                src={img.src}
                alt={img.alt}
                width={600}
                height={450}
                class="w-full h-auto object-cover"
                loading="lazy"
              />
              {img.caption && (
                <p class="text-sm text-text-muted p-4">{img.caption}</p>
              )}
            </div>
          ))}
        </div>
        <div class="text-center mt-12">
          <a href="/our-work" class="btn btn-secondary btn-lg">
            View Full Portfolio &rarr;
          </a>
        </div>
      </div>
    )}

    {service.faqs && service.faqs.length > 0 && (
      <div class="mt-16 md:mt-24">
        <h2 class="text-3xl font-heading font-semibold text-text-dark mb-8 text-center">
          Frequently Asked Questions
        </h2>
        <div class="space-y-4 max-w-2xl mx-auto">
          {service.faqs.map((faq) => (
            <details class="bg-surface p-6 rounded-lg shadow-sm group">
              <summary class="flex justify-between items-center cursor-pointer text-xl font-medium text-text-dark">
                {faq.question}
                <svg class="w-6 h-6 transform transition-transform duration-200 group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
              </summary>
              <p class="mt-4 text-text-muted leading-relaxed">
                {faq.answer}
              </p>
            </details>
          ))}
        </div>
      </div>
    )}
  </section>

  <CtaBlock />
</BaseLayout>